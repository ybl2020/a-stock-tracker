<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aè‚¡ç›¯ç›˜ç¥å™¨ - æµ‹è¯•ç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: #1a1a2e;
            color: #fff;
            padding: 20px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .btn {
            padding: 10px 20px;
            background: #00d4ff;
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            margin: 5px;
        }
        .card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
        }
        input {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #444;
            background: #222;
            color: #fff;
            width: 200px;
        }
        .hidden { display: none; }
        #userInfo { color: #00ff88; margin: 10px 0; }
        .search-result {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ˆ Aè‚¡ç›¯ç›˜ç¥å™¨</h1>
        
        <!-- ç”¨æˆ·åŒºåŸŸ -->
        <div id="userSection" class="card">
            <div id="loginForm">
                <input type="text" id="username" placeholder="ç”¨æˆ·å">
                <input type="password" id="password" placeholder="å¯†ç ">
                <button class="btn" onclick="login()">ç™»å½•/æ³¨å†Œ</button>
            </div>
            <div id="userInfo" class="hidden">
                æ¬¢è¿ï¼Œ<span id="currentUser"></span>
                <button class="btn" onclick="logout()">é€€å‡º</button>
            </div>
        </div>

        <!-- æœç´¢åŒºåŸŸ -->
        <div id="searchSection" class="card hidden">
            <h3>ğŸ” æœç´¢è‚¡ç¥¨</h3>
            <input type="text" id="searchInput" placeholder="è¾“å…¥ä»£ç æˆ–åç§°" onkeyup="if(event.keyCode===13)search()">
            <button class="btn" onclick="search()">æœç´¢</button>
            <div id="searchResults"></div>
        </div>

        <!-- è‡ªé€‰åŒºåŸŸ -->
        <div id="portfolioSection" class="card hidden">
            <h3>â­ æˆ‘çš„è‡ªé€‰</h3>
            <div id="portfolioList">è¯·å…ˆç™»å½•</div>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨
        var currentUser = localStorage.getItem('user');
        var watchlist = JSON.parse(localStorage.getItem('watchlist') || '{}');

        // è‚¡ç¥¨æ•°æ®åº“
        var stockDB = [
            {code:'600519', name:'è´µå·èŒ…å°'},
            {code:'000001', name:'å¹³å®‰é“¶è¡Œ'},
            {code:'300750', name:'å®å¾·æ—¶ä»£'},
            {code:'000858', name:'äº”ç²®æ¶²'},
            {code:'002594', name:'æ¯”äºšè¿ª'},
            {code:'600036', name:'æ‹›å•†é“¶è¡Œ'}
        ];

        // åˆå§‹åŒ–
        window.onload = function() {
            updateUI();
        };

        function updateUI() {
            if (currentUser) {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('currentUser').textContent = currentUser;
                document.getElementById('searchSection').classList.remove('hidden');
                document.getElementById('portfolioSection').classList.remove('hidden');
                renderPortfolio();
            } else {
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('userInfo').classList.add('hidden');
                document.getElementById('searchSection').classList.add('hidden');
                document.getElementById('portfolioSection').classList.add('hidden');
            }
        }

        function login() {
            var username = document.getElementById('username').value.trim();
            var password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                return;
            }
            
            currentUser = username;
            localStorage.setItem('user', username);
            
            if (!watchlist[username]) {
                watchlist[username] = [];
                localStorage.setItem('watchlist', JSON.stringify(watchlist));
            }
            
            updateUI();
            alert('ç™»å½•æˆåŠŸï¼');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('user');
            updateUI();
        }

        function search() {
            var query = document.getElementById('searchInput').value.trim().toLowerCase();
            var results = stockDB.filter(function(s) {
                return s.code.indexOf(query) !== -1 || s.name.indexOf(query) !== -1;
            });
            
            var html = '';
            if (results.length === 0) {
                html = '<p>æœªæ‰¾åˆ°ç›¸å…³è‚¡ç¥¨</p>';
            } else {
                results.forEach(function(stock) {
                    var isAdded = watchlist[currentUser].some(function(s) {
                        return s.code === stock.code;
                    });
                    html += '<div class="search-result">' +
                        '<span>' + stock.name + ' (' + stock.code + ')</span>' +
                        (isAdded ? '<span>å·²æ·»åŠ </span>' : 
                        '<button class="btn" onclick="addStock(\'' + stock.code + '\', \'' + stock.name + '\')">+ æ·»åŠ </button>') +
                        '</div>';
                });
            }
            document.getElementById('searchResults').innerHTML = html;
        }

        function addStock(code, name) {
            if (!currentUser) return;
            
            var exists = watchlist[currentUser].some(function(s) {
                return s.code === code;
            });
            
            if (exists) {
                alert('è¯¥è‚¡ç¥¨å·²åœ¨è‡ªé€‰åˆ—è¡¨ä¸­');
                return;
            }
            
            watchlist[currentUser].push({code: code, name: name});
            localStorage.setItem('watchlist', JSON.stringify(watchlist));
            alert('æ·»åŠ æˆåŠŸï¼');
            search(); // åˆ·æ–°æœç´¢ç»“æœ
            renderPortfolio(); // åˆ·æ–°è‡ªé€‰åˆ—è¡¨
        }

        function renderPortfolio() {
            if (!currentUser) {
                document.getElementById('portfolioList').innerHTML = 'è¯·å…ˆç™»å½•';
                return;
            }
            
            var myStocks = watchlist[currentUser] || [];
            if (myStocks.length === 0) {
                document.getElementById('portfolioList').innerHTML = 'æš‚æ— è‡ªé€‰è‚¡ï¼Œè¯·å…ˆæœç´¢æ·»åŠ ';
                return;
            }
            
            var html = '';
            myStocks.forEach(function(stock) {
                html += '<div class="search-result">' +
                    '<span>' + stock.name + ' (' + stock.code + ')</span>' +
                    '<button class="btn" onclick="removeStock(\'' + stock.code + '\')">åˆ é™¤</button>' +
                    '</div>';
            });
            document.getElementById('portfolioList').innerHTML = html;
        }

        function removeStock(code) {
            if (!currentUser) return;
            watchlist[currentUser] = watchlist[currentUser].filter(function(s) {
                return s.code !== code;
            });
            localStorage.setItem('watchlist', JSON.stringify(watchlist));
            renderPortfolio();
        }
    </script>
</body>
</html>
