<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aè‚¡ç›¯ç›˜ç¥å™¨ Pro</title>
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #00d4ff;
            --primary-dark: #0099cc;
            --danger: #ff4757;
            --success: #2ed573;
            --warning: #ffa502;
            --bg-dark: #0f0f1a;
            --bg-card: rgba(255,255,255,0.05);
            --border: rgba(255,255,255,0.1);
            --text: #fff;
            --text-muted: rgba(255,255,255,0.6);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 100%);
            min-height: 100vh;
            color: var(--text);
        }
        
        /* å¯¼èˆªæ  */
        .navbar {
            background: rgba(15,15,26,0.95);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            font-size: 1.5em;
            font-weight: bold;
            background: linear-gradient(90deg, var(--primary), #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .nav-links a {
            color: var(--text-muted);
            text-decoration: none;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .nav-links a:hover, .nav-links a.active {
            color: var(--primary);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .btn {
            padding: 8px 20px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: #fff;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,212,255,0.3);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }
        
        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        /* é¡µé¢å®¹å™¨ */
        .page {
            display: none;
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .page.active {
            display: block;
        }
        
        /* é¦–é¡µ */
        .hero {
            text-align: center;
            padding: 80px 20px;
        }
        
        .hero h1 {
            font-size: 3em;
            margin-bottom: 20px;
            background: linear-gradient(90deg, var(--primary), #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .hero p {
            font-size: 1.2em;
            color: var(--text-muted);
            margin-bottom: 40px;
        }
        
        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        .hero-buttons .btn {
            padding: 15px 40px;
            font-size: 1.1em;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding: 40px 0;
        }
        
        .feature-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
        }
        
        .feature-card .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .feature-card h3 {
            margin-bottom: 10px;
        }
        
        .feature-card p {
            color: var(--text-muted);
        }
        
        /* æœç´¢é¡µ */
        .search-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .search-box input {
            flex: 1;
            padding: 15px 25px;
            border: 1px solid var(--border);
            border-radius: 30px;
            background: var(--bg-card);
            color: var(--text);
            font-size: 1em;
        }
        
        .search-box input::placeholder {
            color: var(--text-muted);
        }
        
        .search-box .btn {
            padding: 15px 30px;
            border-radius: 30px;
        }
        
        .search-results {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            overflow: hidden;
        }
        
        .search-result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        .stock-info-basic h4 {
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .stock-info-basic span {
            color: var(--text-muted);
            font-size: 0.9em;
        }
        
        /* è‡ªé€‰é¡µ */
        .portfolio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .portfolio-stats {
            display: flex;
            gap: 30px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 20px 30px;
            min-width: 150px;
        }
        
        .stat-card .label {
            color: var(--text-muted);
            font-size: 0.9em;
            margin-bottom: 8px;
        }
        
        .stat-card .value {
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .stat-card .value.up { color: var(--danger); }
        .stat-card .value.down { color: var(--success); }
        
        .stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .stock-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .stock-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }
        
        .stock-card.selected {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0,212,255,0.2);
        }
        
        .stock-card.up { border-left: 4px solid var(--danger); }
        .stock-card.down { border-left: 4px solid var(--success); }
        
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .stock-title h3 {
            font-size: 1.2em;
            margin-bottom: 3px;
        }
        
        .stock-title span {
            color: var(--text-muted);
            font-size: 0.85em;
        }
        
        .stock-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.1);
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-icon:hover {
            background: var(--danger);
        }
        
        .stock-price-main {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stock-change {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .change-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .change-badge.up {
            background: rgba(255,71,87,0.2);
            color: var(--danger);
        }
        
        .change-badge.down {
            background: rgba(46,213,115,0.2);
            color: var(--success);
        }
        
        .position-info {
            background: rgba(0,212,255,0.1);
            border-radius: 10px;
            padding: 12px;
            margin-top: 15px;
        }
        
        .position-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .position-row:last-child {
            margin-bottom: 0;
            padding-top: 8px;
            border-top: 1px solid var(--border);
        }
        
        .position-row .profit {
            font-weight: bold;
        }
        
        .position-row .profit.up { color: var(--danger); }
        .position-row .profit.down { color: var(--success); }
        
        /* è¯¦æƒ…é¡µ */
        .detail-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }
        
        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            height: 500px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .chart-tabs {
            display: flex;
            gap: 5px;
        }
        
        .chart-tab {
            padding: 6px 15px;
            border-radius: 15px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.85em;
        }
        
        .chart-tab.active {
            background: var(--primary);
            color: #fff;
        }
        
        #klineChart {
            height: calc(100% - 50px);
        }
        
        .detail-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .info-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 20px;
        }
        
        .info-card h3 {
            margin-bottom: 15px;
            font-size: 1em;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-row span:first-child {
            color: var(--text-muted);
        }
        
        .position-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .position-form input {
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            color: var(--text);
        }
        
        /* æ–°é—» */
        .news-list {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            overflow: hidden;
        }
        
        .news-item {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .news-item:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .news-item:last-child {
            border-bottom: none;
        }
        
        .news-time {
            color: var(--text-muted);
            font-size: 0.85em;
            margin-bottom: 5px;
        }
        
        .news-title {
            font-size: 1em;
            line-height: 1.5;
        }
        
        /* ç™»å½•å¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
        }
        
        .modal-content h2 {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-muted);
            font-size: 0.9em;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--bg-card);
            color: var(--text);
            font-size: 1em;
        }
        
        .modal-content .btn {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
        }
        
        .modal-footer {
            text-align: center;
            margin-top: 20px;
            color: var(--text-muted);
            font-size: 0.9em;
        }
        
        .modal-footer a {
            color: var(--primary);
            cursor: pointer;
        }
        
        /* æç¤ºæ¶ˆæ¯ */
        .toast {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: #fff;
            font-weight: bold;
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 2000;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }
        .toast.info { background: var(--primary); }
        
        /* å“åº”å¼ */
        @media (max-width: 1024px) {
            .detail-layout {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .navbar {
                padding: 15px 20px;
            }
            
            .nav-links {
                display: none;
            }
            
            .hero h1 {
                font-size: 2em;
            }
            
            .portfolio-stats {
                flex-wrap: wrap;
            }
            
            .stock-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--text);
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="logo">ğŸ“ˆ Aè‚¡ç›¯ç›˜ç¥å™¨ Pro</div>
        <div class="nav-links">
            <a onclick="showPage('home')" data-page="home">é¦–é¡µ</a>
            <a onclick="showPage('search')" data-page="search">æœç´¢</a>
            <a onclick="showPage('portfolio')" data-page="portfolio">è‡ªé€‰</a>
            <a onclick="showPage('market')" data-page="market">è¡Œæƒ…</a>
        </div>
        <div class="user-menu">
            <span id="userDisplay" style="display:none;"></span>
            <button id="loginBtn" class="btn btn-primary" onclick="showLoginModal()">ç™»å½•</button>
            <button id="logoutBtn" class="btn btn-outline" onclick="logout()" style="display:none;">é€€å‡º</button>
        </div>
    </nav>

    <!-- é¦–é¡µ -->
    <div id="page-home" class="page active">
        <div class="hero">
            <h1>æ™ºèƒ½ç›¯ç›˜ï¼Œè½»æ¾æŠ•èµ„</h1>
            <p>å®æ—¶è¡Œæƒ…ã€æˆæœ¬è®°å½•ã€Kçº¿åˆ†æã€æ–°é—»èµ„è®¯ï¼Œä¸€ç«™å¼è‚¡ç¥¨æŠ•èµ„åŠ©æ‰‹</p>
            <div class="hero-buttons">
                <button class="btn btn-primary" onclick="showPage('search')">ç«‹å³æœç´¢è‚¡ç¥¨</button>
                <button class="btn btn-outline" onclick="showPage('portfolio')">æŸ¥çœ‹è‡ªé€‰</button>
            </div>
        </div>
        
        <div class="features">
            <div class="feature-card">
                <div class="icon">ğŸ“Š</div>
                <h3>å®æ—¶è¡Œæƒ…</h3>
                <p>5ç§’è‡ªåŠ¨åˆ·æ–°ï¼Œæ”¯æŒæ²ªæ·±äº¬æ‰€æœ‰è‚¡ç¥¨</p>
            </div>
            <div class="feature-card">
                <div class="icon">ğŸ’°</div>
                <h3>æˆæœ¬è®°å½•</h3>
                <p>è®°å½•æŒä»“æˆæœ¬ï¼Œå®æ—¶è®¡ç®—ç›ˆäº</p>
            </div>
            <div class="feature-card">
                <div class="icon">ğŸ“ˆ</div>
                <h3>Kçº¿å›¾è¡¨</h3>
                <p>ä¸“ä¸šçš„æ—¥Kã€å‘¨Kã€æœˆKèµ°åŠ¿åˆ†æ</p>
            </div>
            <div class="feature-card">
                <div class="icon">ğŸ“°</div>
                <h3>æ–°é—»èµ„è®¯</h3>
                <p>åŠæ—¶è·å–ä¸ªè‚¡ç›¸å…³å…¬å‘Šå’Œæ–°é—»</p>
            </div>
        </div>
    </div>

    <!-- æœç´¢é¡µ -->
    <div id="page-search" class="page">
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç æˆ–åç§°ï¼ˆå¦‚ï¼š600519 æˆ– èŒ…å°ï¼‰" onkeypress="if(event.key==='Enter')searchStocks()">
                <button class="btn btn-primary" onclick="searchStocks()">ğŸ” æœç´¢</button>
            </div>
            <div id="searchResults" class="search-results" style="display:none;"></div>
        </div>
    </div>

    <!-- è‡ªé€‰é¡µ -->
    <div id="page-portfolio" class="page">
        <div id="portfolioContent">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ”’</div>
                <h3>è¯·å…ˆç™»å½•</h3>
                <p>ç™»å½•åå¯ä»¥æ·»åŠ è‡ªé€‰è‚¡å¹¶è®°å½•æŒä»“æˆæœ¬</p>
                <button class="btn btn-primary" onclick="showLoginModal()" style="margin-top:20px;">ç«‹å³ç™»å½•</button>
            </div>
        </div>
    </div>

    <!-- è¡Œæƒ…é¡µ -->
    <div id="page-market" class="page">
        <div style="text-align:center; padding:60px 20px; color:var(--text-muted);">
            <div style="font-size:4em; margin-bottom:20px;">ğŸ“ˆ</div>
            <h3>åŠŸèƒ½å¼€å‘ä¸­</h3>
            <p>å¤§ç›˜è¡Œæƒ…åŠŸèƒ½å³å°†ä¸Šçº¿</p>
        </div>
    </div>

    <!-- è¯¦æƒ…é¡µ -->
    <div id="page-detail" class="page">
        <div style="margin-bottom:20px;">
            <button class="btn btn-outline" onclick="showPage('portfolio')">â† è¿”å›è‡ªé€‰</button>
        </div>
        <div class="detail-layout">
            <div class="chart-container">
                <div class="chart-header">
                    <h3 id="detailStockName">--</h3>
                    <div class="chart-tabs">
                        <button class="chart-tab active" onclick="switchPeriod('day')">æ—¥K</button>
                        <button class="chart-tab" onclick="switchPeriod('week')">å‘¨K</button>
                        <button class="chart-tab" onclick="switchPeriod('month')">æœˆK</button>
                    </div>
                </div>
                <div id="klineChart"></div>
            </div>
            
            <div class="detail-sidebar">
                <div class="info-card">
                    <h3>ğŸ“Š å®æ—¶è¡Œæƒ…</h3>
                    <div class="info-row">
                        <span>æœ€æ–°ä»·</span>
                        <span id="detailPrice">--</span>
                    </div>
                    <div class="info-row">
                        <span>æ¶¨è·Œå¹…</span>
                        <span id="detailChange">--</span>
                    </div>
                    <div class="info-row">
                        <span>ä»Šå¼€</span>
                        <span id="detailOpen">--</span>
                    </div>
                    <div class="info-row">
                        <span>æœ€é«˜</span>
                        <span id="detailHigh">--</span>
                    </div>
                    <div class="info-row">
                        <span>æœ€ä½</span>
                        <span id="detailLow">--</span>
                    </div>
                    <div class="info-row">
                        <span>æˆäº¤é‡</span>
                        <span id="detailVolume">--</span>
                    </div>
                </div>
                
                <div class="info-card" id="positionCard" style="display:none;">
                    <h3>ğŸ’° æˆ‘çš„æŒä»“</h3>
                    <div class="position-form">
                        <input type="number" id="positionCost" placeholder="æˆæœ¬ä»·" step="0.01">
                        <input type="number" id="positionShares" placeholder="æŒä»“æ•°é‡" step="100">
                        <button class="btn btn-primary" onclick="savePosition()">ä¿å­˜æŒä»“</button>
                    </div>
                </div>
                
                <div class="info-card">
                    <h3>ğŸ“° ç›¸å…³æ–°é—»</h3>
                    <div id="newsList" style="max-height:300px; overflow-y:auto;">
                        <div style="color:var(--text-muted); text-align:center; padding:20px;">æš‚æ— æ–°é—»</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç™»å½•å¼¹çª— -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">ç™»å½•</h2>
            <div class="form-group">
                <label>ç”¨æˆ·å</label>
                <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
            </div>
            <div class="form-group">
                <label>å¯†ç </label>
                <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <button class="btn btn-primary" onclick="handleAuth()">ç™»å½•</button>
            <div class="modal-footer">
                <span id="modalFooterText">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<a onclick="toggleAuthMode()">ç«‹å³æ³¨å†Œ</a></span>
            </div>
        </div>
    </div>

    <!-- æç¤ºæ¶ˆæ¯ -->
    <div id="toast" class="toast"></div>

    <script>
        // ==================== æ•°æ®å­˜å‚¨ ====================
        const Storage = {
            get(key) {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            },
            set(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            }
        };

        // ==================== çŠ¶æ€ç®¡ç† ====================
        let currentUser = Storage.get('currentUser');
        let watchlist = Storage.get('watchlist') || {};
        let stockData = {};
        let currentDetailStock = null;
        let currentPeriod = 'day';
        let isLoginMode = true;
        let klineChart = null;

        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', () => {
            updateAuthUI();
            if (currentUser && watchlist[currentUser]) {
                startAutoUpdate();
            }
        });

        // ==================== é¡µé¢åˆ‡æ¢ ====================
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
            
            document.getElementById(`page-${page}`).classList.add('active');
            document.querySelector(`[data-page="${page}"]`)?.classList.add('active');
            
            if (page === 'portfolio') {
                renderPortfolio();
            }
        }

        // ==================== ç”¨æˆ·è®¤è¯ ====================
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }

        function hideLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('modalTitle').textContent = isLoginMode ? 'ç™»å½•' : 'æ³¨å†Œ';
            document.querySelector('.modal-content .btn').textContent = isLoginMode ? 'ç™»å½•' : 'æ³¨å†Œ';
            document.getElementById('modalFooterText').innerHTML = isLoginMode 
                ? 'è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<a onclick="toggleAuthMode()">ç«‹å³æ³¨å†Œ</a>'
                : 'å·²æœ‰è´¦å·ï¼Ÿ<a onclick="toggleAuthMode()">ç«‹å³ç™»å½•</a>';
        }

        function handleAuth() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                showToast('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
                return;
            }
            
            if (isLoginMode) {
                // ç™»å½•
                const users = Storage.get('users') || {};
                if (!users[username] || users[username].password !== password) {
                    showToast('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯', 'error');
                    return;
                }
                currentUser = username;
                Storage.set('currentUser', username);
                showToast('ç™»å½•æˆåŠŸ', 'success');
            } else {
                // æ³¨å†Œ
                const users = Storage.get('users') || {};
                if (users[username]) {
                    showToast('ç”¨æˆ·åå·²å­˜åœ¨', 'error');
                    return;
                }
                users[username] = { password, createdAt: new Date().toISOString() };
                Storage.set('users', users);
                currentUser = username;
                Storage.set('currentUser', username);
                showToast('æ³¨å†ŒæˆåŠŸ', 'success');
            }
            
            hideLoginModal();
            updateAuthUI();
            renderPortfolio();
            startAutoUpdate();
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateAuthUI();
            showToast('å·²é€€å‡ºç™»å½•', 'info');
            showPage('home');
        }

        function updateAuthUI() {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const userDisplay = document.getElementById('userDisplay');
            
            if (currentUser) {
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
                userDisplay.style.display = 'block';
                userDisplay.textContent = `ğŸ‘¤ ${currentUser}`;
            } else {
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
                userDisplay.style.display = 'none';
            }
        }

        // ==================== è‚¡ç¥¨æœç´¢ ====================
        const stockDatabase = [
            { code: '600519', name: 'è´µå·èŒ…å°', pinyin: 'maotai' },
            { code: '000001', name: 'å¹³å®‰é“¶è¡Œ', pinyin: 'pinganyinhang' },
            { code: '300750', name: 'å®å¾·æ—¶ä»£', pinyin: 'ningdeshidai' },
            { code: '000858', name: 'äº”ç²®æ¶²', pinyin: 'wuliangye' },
            { code: '002594', name: 'æ¯”äºšè¿ª', pinyin: 'biyadi' },
            { code: '600036', name: 'æ‹›å•†é“¶è¡Œ', pinyin: 'zhaoshangyinhang' },
            { code: '000333', name: 'ç¾çš„é›†å›¢', pinyin: 'meidijituan' },
            { code: '002415', name: 'æµ·åº·å¨è§†', pinyin: 'haikangweishi' },
            { code: '600276', name: 'æ’ç‘åŒ»è¯', pinyin: 'hengruiyiyao' },
            { code: '002230', name: 'ç§‘å¤§è®¯é£', pinyin: 'kaidaxunfei' },
            { code: '688981', name: 'ä¸­èŠ¯å›½é™…', pinyin: 'zhongxinguoji' },
            { code: '688256', name: 'å¯’æ­¦çºª', pinyin: 'hanwuji' },
            { code: '300760', name: 'è¿ˆç‘åŒ»ç–—', pinyin: 'mairuiyiliao' },
            { code: '300059', name: 'ä¸œæ–¹è´¢å¯Œ', pinyin: 'dongfangcaifu' },
            { code: '002142', name: 'å®æ³¢é“¶è¡Œ', pinyin: 'ningboyinhang' },
            { code: '600309', name: 'ä¸‡ååŒ–å­¦', pinyin: 'wanhuahuaxue' },
            { code: '600887', name: 'ä¼Šåˆ©è‚¡ä»½', pinyin: 'yiligufen' },
            { code: '601888', name: 'ä¸­å›½ä¸­å…', pinyin: 'zhongguozhongmian' },
            { code: '002352', name: 'é¡ºä¸°æ§è‚¡', pinyin: 'shunkongkonggu' },
            { code: '600900', name: 'é•¿æ±Ÿç”µåŠ›', pinyin: 'changjiangdianli' },
            { code: '601012', name: 'éš†åŸºç»¿èƒ½', pinyin: 'longjilvneng' },
            { code: '603288', name: 'æµ·å¤©å‘³ä¸š', pinyin: 'haitianweiye' },
            { code: '002475', name: 'ç«‹è®¯ç²¾å¯†', pinyin: 'lixunjingmi' },
            { code: '600030', name: 'ä¸­ä¿¡è¯åˆ¸', pinyin: 'zhongxinzhengquan' },
            { code: '000002', name: 'ä¸‡ç§‘A', pinyin: 'wanke' },
            { code: '300124', name: 'æ±‡å·æŠ€æœ¯', pinyin: 'huichuanjishu' },
            { code: '002271', name: 'ä¸œæ–¹é›¨è™¹', pinyin: 'dongfangyuhong' },
            { code: '601318', name: 'ä¸­å›½å¹³å®‰', pinyin: 'zhongguopingan' },
            { code: '600438', name: 'é€šå¨è‚¡ä»½', pinyin: 'tongweigufen' },
            { code: '603259', name: 'è¯æ˜åº·å¾·', pinyin: 'yaomingkangde' },
            { code: '000568', name: 'æ³¸å·è€çª–', pinyin: 'luzhoulaojiao' },
            { code: '601166', name: 'å…´ä¸šé“¶è¡Œ', pinyin: 'xingyeyinhang' },
            { code: '300014', name: 'äº¿çº¬é”‚èƒ½', pinyin: 'yiweilineng' },
            { code: '002304', name: 'æ´‹æ²³è‚¡ä»½', pinyin: 'yanghegufen' },
            { code: '601398', name: 'å·¥å•†é“¶è¡Œ', pinyin: 'gongshangyinhang' },
            { code: '600809', name: 'å±±è¥¿æ±¾é…’', pinyin: 'shanxifenhua' },
            { code: '000725', name: 'äº¬ä¸œæ–¹A', pinyin: 'jingdongfang' },
            { code: '601899', name: 'ç´«é‡‘çŸ¿ä¸š', pinyin: 'zijinkuangye' },
            { code: '603501', name: 'éŸ¦å°”è‚¡ä»½', pinyin: 'weiergufen' },
            { code: '601668', name: 'ä¸­å›½å»ºç­‘', pinyin: 'zhongguojianzhu' },
            { code: '002714', name: 'ç‰§åŸè‚¡ä»½', pinyin: 'muyuangufen' },
            { code: '300433', name: 'è“æ€ç§‘æŠ€', pinyin: 'lansikeji' },
            { code: '601211', name: 'å›½æ³°å›å®‰', pinyin: 'guotaijunan' },
            { code: '601288', name: 'å†œä¸šé“¶è¡Œ', pinyin: 'nongyeyinhang' },
            { code: '601088', name: 'ä¸­å›½ç¥å', pinyin: 'zhongguoshenhua' },
            { code: '000538', name: 'äº‘å—ç™½è¯', pinyin: 'yunnanbaiyao' },
            { code: '601601', name: 'ä¸­å›½å¤ªä¿', pinyin: 'zhongguotaibao' },
            { code: '601628', name: 'ä¸­å›½äººå¯¿', pinyin: 'zhongguorenshou' },
            { code: '002460', name: 'èµ£é”‹é”‚ä¸š', pinyin: 'ganfengliye' },
            { code: '601818', name: 'å…‰å¤§é“¶è¡Œ', pinyin: 'guangdayinhang' },
        ];

        function searchStocks() {
            const query = document.getElementById('searchInput').value.trim().toLowerCase();
            if (!query) return;
            
            const results = stockDatabase.filter(s => 
                s.code.includes(query) || 
                s.name.includes(query) || 
                s.pinyin.includes(query)
            );
            
            renderSearchResults(results);
        }

        function renderSearchResults(results) {
            const container = document.getElementById('searchResults');
            
            if (results.length === 0) {
                container.innerHTML = '<div style="padding:40px; text-align:center; color:var(--text-muted);">æœªæ‰¾åˆ°ç›¸å…³è‚¡ç¥¨</div>';
                container.style.display = 'block';
                return;
            }
            
            container.innerHTML = results.map(stock => {
                const isWatched = currentUser && watchlist[currentUser]?.some(s => s.code === stock.code);
                return `
                    <div class="search-result-item">
                        <div class="stock-info-basic">
                            <h4>${stock.name}</h4>
                            <span>${stock.code}</span>
                        </div>
                        <button class="btn ${isWatched ? 'btn-outline' : 'btn-primary'}" 
                                onclick="toggleWatchlist('${stock.code}', '${stock.name}', this)"
                                ${isWatched ? 'disabled' : ''}>
                            ${isWatched ? 'âœ“ å·²æ·»åŠ ' : '+ æ·»åŠ è‡ªé€‰'}
                        </button>
                    </div>
                `;
            }).join('');
            
            container.style.display = 'block';
        }

        // ==================== è‡ªé€‰è‚¡ç®¡ç† ====================
        function toggleWatchlist(code, name, btn) {
            if (!currentUser) {
                showToast('è¯·å…ˆç™»å½•', 'error');
                showLoginModal();
                return;
            }
            
            if (!watchlist[currentUser]) {
                watchlist[currentUser] = [];
            }
            
            const exists = watchlist[currentUser].some(s => s.code === code);
            if (exists) {
                showToast('è¯¥è‚¡ç¥¨å·²åœ¨è‡ªé€‰åˆ—è¡¨ä¸­', 'info');
                return;
            }
            
            watchlist[currentUser].push({
                code,
                name,
                cost: null,
                shares: null,
                addedAt: new Date().toISOString()
            });
            
            Storage.set('watchlist', watchlist);
            showToast('æ·»åŠ æˆåŠŸ', 'success');
            
            if (btn) {
                btn.textContent = 'âœ“ å·²æ·»åŠ ';
                btn.className = 'btn btn-outline';
                btn.disabled = true;
            }
            
            fetchStockData();
        }

        function removeFromWatchlist(code) {
            if (!currentUser || !watchlist[currentUser]) return;
            
            watchlist[currentUser] = watchlist[currentUser].filter(s => s.code !== code);
            delete stockData[code];
            Storage.set('watchlist', watchlist);
            renderPortfolio();
            showToast('å·²ä»è‡ªé€‰ç§»é™¤', 'info');
        }

        // ==================== æ¸²æŸ“è‡ªé€‰é¡µ ====================
        function renderPortfolio() {
            const container = document.getElementById('portfolioContent');
            
            if (!currentUser) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ”’</div>
                        <h3>è¯·å…ˆç™»å½•</h3>
                        <p>ç™»å½•åå¯ä»¥æ·»åŠ è‡ªé€‰è‚¡å¹¶è®°å½•æŒä»“æˆæœ¬</p>
                        <button class="btn btn-primary" onclick="showLoginModal()" style="margin-top:20px;">ç«‹å³ç™»å½•</button>
                    </div>
                `;
                return;
            }
            
            const myStocks = watchlist[currentUser] || [];
            
            if (myStocks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“Š</div>
                        <h3>æš‚æ— è‡ªé€‰è‚¡</h3>
                        <p>å»æœç´¢é¡µé¢æ·»åŠ ä½ å…³æ³¨çš„è‚¡ç¥¨</p>
                        <button class="btn btn-primary" onclick="showPage('search')" style="margin-top:20px;">å»æœç´¢</button>
                    </div>
                `;
                return;
            }
            
            // è®¡ç®—æ€»ç›ˆäº
            let totalCost = 0, totalValue = 0, todayProfit = 0;
            
            myStocks.forEach(stock => {
                const data = stockData[stock.code];
                if (data && stock.cost && stock.shares) {
                    const cost = stock.cost * stock.shares;
                    const value = data.price * stock.shares;
                    totalCost += cost;
                    totalValue += value;
                    todayProfit += data.change * stock.shares;
                }
            });
            
            const totalProfit = totalValue - totalCost;
            const profitPercent = totalCost > 0 ? (totalProfit / totalCost * 100) : 0;
            
            container.innerHTML = `
                <div class="portfolio-header">
                    <h2>æˆ‘çš„è‡ªé€‰</h2>
                    <div class="portfolio-stats">
                        <div class="stat-card">
                            <div class="label">æ€»ç›ˆäº</div>
                            <div class="value ${totalProfit >= 0 ? 'up' : 'down'}">
                                ${totalProfit >= 0 ? '+' : ''}${totalProfit.toFixed(2)}
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="label">ç›ˆäºæ¯”ä¾‹</div>
                            <div class="value ${profitPercent >= 0 ? 'up' : 'down'}">
                                ${profitPercent >= 0 ? '+' : ''}${profitPercent.toFixed(2)}%
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="label">ä»Šæ—¥ç›ˆäº</div>
                            <div class="value ${todayProfit >= 0 ? 'up' : 'down'}">
                                ${todayProfit >= 0 ? '+' : ''}${todayProfit.toFixed(2)}
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="label">æŒä»“å¸‚å€¼</div>
                            <div class="value">${totalValue.toFixed(2)}</div>
                        </div>
                    </div>
                </div>
                <div class="stock-grid">
                    ${myStocks.map(stock => renderStockCard(stock)).join('')}
                </div>
            `;
        }

        function renderStockCard(stock) {
            const data = stockData[stock.code];
            
            if (!data) {
                return `
                    <div class="stock-card" onclick="showStockDetail('${stock.code}')">
                        <div class="stock-header">
                            <div class="stock-title">
                                <h3>${stock.name}</h3>
                                <span>${stock.code}</span>
                            </div>
                            <div class="stock-actions">
                                <button class="btn-icon" onclick="event.stopPropagation(); removeFromWatchlist('${stock.code}')">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                        <div style="color:var(--text-muted); padding:20px 0;">åŠ è½½ä¸­...</div>
                    </div>
                `;
            }
            
            const isUp = data.change >= 0;
            const changeSymbol = isUp ? '+' : '';
            
            let positionHtml = '';
            if (stock.cost && stock.shares) {
                const cost = stock.cost * stock.shares;
                const value = data.price * stock.shares;
                const profit = value - cost;
                const profitPercent = (profit / cost * 100);
                const isProfitUp = profit >= 0;
                
                positionHtml = `
                    <div class="position-info">
                        <div class="position-row">
                            <span>æˆæœ¬ ${stock.cost.toFixed(2)} Ã— ${stock.shares}è‚¡</span>
                            <span>å¸‚å€¼ ${value.toFixed(2)}</span>
                        </div>
                        <div class="position-row">
                            <span>ç›ˆäº</span>
                            <span class="profit ${isProfitUp ? 'up' : 'down'}">
                                ${isProfitUp ? '+' : ''}${profit.toFixed(2)} (${isProfitUp ? '+' : ''}${profitPercent.toFixed(2)}%)
                            </span>
                        </div>
                    </div>
                `;
            } else {
                positionHtml = `
                    <div class="position-info" style="background:transparent; border:1px dashed var(--border);">
                        <div style="color:var(--text-muted); text-align:center; font-size:0.9em;">
                            ç‚¹å‡»å¡ç‰‡æ·»åŠ æŒä»“æˆæœ¬
                        </div>
                    </div>
                `;
            }
            
            return `
                <div class="stock-card ${isUp ? 'up' : 'down'}" onclick="showStockDetail('${stock.code}')">
                    <div class="stock-header">
                        <div class="stock-title">
                            <h3>${data.name}</h3>
                            <span>${stock.code}</span>
                        </div>
                        <div class="stock-actions">
                            <button class="btn-icon" onclick="event.stopPropagation(); removeFromWatchlist('${stock.code}')">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <div class="stock-price-main">${data.price.toFixed(2)}</div>
                    <div class="stock-change">
                        <span class="change-badge ${isUp ? 'up' : 'down'}">${changeSymbol}${data.change.toFixed(2)}</span>
                        <span class="change-badge ${isUp ? 'up' : 'down'}">${changeSymbol}${data.changePercent.toFixed(2)}%</span>
                    </div>
                    ${positionHtml}
                </div>
            `;
        }

        // ==================== è‚¡ç¥¨è¯¦æƒ… ====================
        function showStockDetail(code) {
            currentDetailStock = code;
            showPage('detail');
            
            const stock = watchlist[currentUser]?.find(s => s.code === code);
            const data = stockData[code];
            
            if (data) {
                document.getElementById('detailStockName').textContent = `${data.name} (${code})`;
                document.getElementById('detailPrice').textContent = data.price.toFixed(2);
                document.getElementById('detailChange').textContent = 
                    `${data.change >= 0 ? '+' : ''}${data.change.toFixed(2)} (${data.changePercent.toFixed(2)}%)`;
                document.getElementById('detailChange').className = data.change >= 0 ? 'up' : 'down';
                document.getElementById('detailOpen').textContent = data.open?.toFixed(2) || '--';
                document.getElementById('detailHigh').textContent = data.high?.toFixed(2) || '--';
                document.getElementById('detailLow').textContent = data.low?.toFixed(2) || '--';
                document.getElementById('detailVolume').textContent = 
                    data.turnover ? (data.turnover / 10000).toFixed(2) + 'äº¿' : '--';
            }
            
            // æ˜¾ç¤ºæŒä»“è¡¨å•
            const positionCard = document.getElementById('positionCard');
            if (currentUser && stock) {
                positionCard.style.display = 'block';
                document.getElementById('positionCost').value = stock.cost || '';
                document.getElementById('positionShares').value = stock.shares || '';
            } else {
                positionCard.style.display = 'none';
            }
            
            // åˆå§‹åŒ–Kçº¿å›¾
            setTimeout(() => initKlineChart(), 100);
            
            // åŠ è½½æ–°é—»
            loadNews(code);
        }

        function savePosition() {
            if (!currentUser || !currentDetailStock) return;
            
            const cost = parseFloat(document.getElementById('positionCost').value);
            const shares = parseInt(document.getElementById('positionShares').value);
            
            if (!cost || !shares || cost <= 0 || shares <= 0) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„æˆæœ¬ä»·å’Œæ•°é‡', 'error');
                return;
            }
            
            const stock = watchlist[currentUser].find(s => s.code === currentDetailStock);
            if (stock) {
                stock.cost = cost;
                stock.shares = shares;
                Storage.set('watchlist', watchlist);
                showToast('æŒä»“è®°å½•å·²ä¿å­˜', 'success');
                fetchStockData();
            }
        }

        // ==================== Kçº¿å›¾ ====================
        function initKlineChart() {
            const chartContainer = document.getElementById('klineChart');
            if (!chartContainer) return;
            
            chartContainer.innerHTML = '';
            
            klineChart = LightweightCharts.createChart(chartContainer, {
                layout: {
                    background: { type: 'solid', color: 'transparent' },
                    textColor: '#d1d4dc',
                },
                grid: {
                    vertLines: { color: 'rgba(255,255,255,0.1)' },
                    horzLines: { color: 'rgba(255,255,255,0.1)' },
                },
                crosshair: {
                    mode: LightweightCharts.CrosshairMode.Normal,
                },
                rightPriceScale: {
                    borderColor: 'rgba(255,255,255,0.1)',
                },
                timeScale: {
                    borderColor: 'rgba(255,255,255,0.1)',
                },
            });
            
            const candlestickSeries = klineChart.addCandlestickSeries({
                upColor: '#ff4757',
                downColor: '#2ed573',
                borderUpColor: '#ff4757',
                borderDownColor: '#2ed573',
                wickUpColor: '#ff4757',
                wickDownColor: '#2ed573',
            });
            
            // æ¨¡æ‹ŸKçº¿æ•°æ®
            const data = generateMockKlineData();
            candlestickSeries.setData(data);
            klineChart.timeScale().fitContent();
        }

        function generateMockKlineData() {
            const data = [];
            let price = 100;
            const now = new Date();
            
            for (let i = 100; i >= 0; i--) {
                const date = new Date(now);
                date.setDate(date.getDate() - i);
                
                const open = price + (Math.random() - 0.5) * 5;
                const close = open + (Math.random() - 0.5) * 5;
                const high = Math.max(open, close) + Math.random() * 3;
                const low = Math.min(open, close) - Math.random() * 3;
                
                data.push({
                    time: date.toISOString().split('T')[0],
                    open: parseFloat(open.toFixed(2)),
                    high: parseFloat(high.toFixed(2)),
                    low: parseFloat(low.toFixed(2)),
                    close: parseFloat(close.toFixed(2)),
                });
                
                price = close;
            }
            
            return data;
        }

        function switchPeriod(period) {
            currentPeriod = period;
            document.querySelectorAll('.chart-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            initKlineChart();
        }

        // ==================== æ–°é—» ====================
        function loadNews(code) {
            const newsList = document.getElementById('newsList');
            
            // æ¨¡æ‹Ÿæ–°é—»æ•°æ®
            const news = [
                { time: '10åˆ†é’Ÿå‰', title: `${code} ä¸»åŠ›å‡€æµå…¥è¶…5000ä¸‡å…ƒï¼Œèµ„é‡‘å…³æ³¨åº¦æå‡` },
                { time: '1å°æ—¶å‰', title: `${code} å‘å¸ƒæœ€æ–°å…¬å‘Šï¼šç¬¬ä¸‰å­£åº¦ä¸šç»©é¢„å¢` },
                { time: '3å°æ—¶å‰', title: `æœºæ„è°ƒç ”ï¼š${code} è·å¾—å¤šå®¶æœºæ„å¯†é›†è°ƒç ”` },
                { time: 'æ˜¨å¤©', title: `${code} ä»Šæ—¥ç›˜ä¸­å¼‚åŠ¨ï¼Œæˆäº¤é‡æ˜æ˜¾æ”¾å¤§` },
                { time: 'æ˜¨å¤©', title: `è¡Œä¸šå¿«è®¯ï¼šç›¸å…³æ¿å—ä»Šæ—¥è¡¨ç°æ´»è·ƒ` },
            ];
            
            newsList.innerHTML = news.map(n => `
                <div class="news-item">
                    <div class="news-time">${n.time}</div>
                    <div class="news-title">${n.title}</div>
                </div>
            `).join('');
        }

        // ==================== å®æ—¶æ•°æ®æ›´æ–° ====================
        async function fetchStockData() {
            if (!currentUser) return;
            
            const myStocks = watchlist[currentUser] || [];
            if (myStocks.length === 0) return;
            
            try {
                const codes = myStocks.map(s => formatStockCode(s.code)).join(',');
                const url = `https://qt.gtimg.cn/q=${codes}`;
                const response = await fetch(url);
                const buffer = await response.arrayBuffer();
                const decoder = new TextDecoder('GBK');
                const text = decoder.decode(buffer);
                
                parseStockData(text);
                
                // æ›´æ–°å½“å‰é¡µé¢
                if (document.getElementById('page-portfolio').classList.contains('active')) {
                    renderPortfolio();
                }
                if (currentDetailStock && document.getElementById('page-detail').classList.contains('active')) {
                    showStockDetail(currentDetailStock);
                }
            } catch (error) {
                console.error('è·å–æ•°æ®å¤±è´¥:', error);
            }
        }

        function parseStockData(text) {
            const lines = text.split(';');
            lines.forEach(line => {
                const match = line.match(/v_(\w+)="([^"]+)"/);
                if (match) {
                    const fullCode = match[1];
                    // è½¬æ¢ä¸ºçº¯æ•°å­—ä»£ç  (sh600519 -> 600519)
                    const code = fullCode.replace(/^(sh|sz|bj)/, '');
                    const data = match[2].split('~');
                    if (data.length > 40) {
                        const price = parseFloat(data[3]);
                        if (!isNaN(price) && price > 0) {
                            stockData[code] = {
                                name: data[1] || 'æœªçŸ¥',
                                price: price,
                                change: parseFloat(data[4]),
                                changePercent: parseFloat(data[5]),
                                open: parseFloat(data[8]) || 0,
                                high: parseFloat(data[9]) || 0,
                                low: parseFloat(data[10]) || 0,
                                turnover: parseFloat(data[14]) || 0,
                            };
                        }
                    }
                }
            });
        }

        function formatStockCode(code) {
            code = code.replace(/\D/g, '');
            if (code.length !== 6) return code;
            if (code.startsWith('60') || code.startsWith('68') || code.startsWith('51') || code.startsWith('50')) return 'sh' + code;
            else if (code.startsWith('0') || code.startsWith('3')) return 'sz' + code;
            else if (code.startsWith('8') || code.startsWith('4')) return 'bj' + code;
            return code;
        }

        function startAutoUpdate() {
            fetchStockData();
            setInterval(fetchStockData, 5000);
        }

        // ==================== å·¥å…·å‡½æ•° ====================
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('loginModal').addEventListener('click', (e) => {
            if (e.target.id === 'loginModal') hideLoginModal();
        });
    </script>
</body>
</html>
